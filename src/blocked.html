<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Time Manager - Access Blocked</title>
  <link rel="stylesheet" href="dist/styles.css">
</head>
<body class="m-0 p-0">
  <div class="blocked-container">
    <div class="blocked-content">
      <div class="blocked-icon">🚫</div>
      
      <h1 class="blocked-title">Access Blocked</h1>
      <h2 class="blocked-subtitle" id="site-name">Website</h2>
      
      <p class="blocked-message">
        You've reached your daily time limit for this website. Take a break and try some productive activities instead!
      </p>

      <div class="stats-container">
        <div class="stats-title">Today's Usage</div>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="time-used">30:00</div>
            <div class="stat-label">Time Used</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="limit-reached">100%</div>
            <div class="stat-label">Limit Reached</div>
          </div>
        </div>
      </div>

      <div class="reset-info">
        <div class="reset-icon">🔄</div>
        <div class="reset-text">Your time limit will reset at midnight</div>
        <div class="countdown" id="countdown">--:--:--</div>
      </div>

      <div class="suggestions">
        <div class="suggestions-title">💡 Try these productive alternatives:</div>
        <ul class="suggestion-list">
          <li class="suggestion-item">
            <span class="suggestion-icon">📚</span>
            <span>Read a book or article</span>
          </li>
          <li class="suggestion-item">
            <span class="suggestion-icon">🏃‍♂️</span>
            <span>Go for a walk or exercise</span>
          </li>
          <li class="suggestion-item">
            <span class="suggestion-icon">🧘</span>
            <span>Practice meditation or mindfulness</span>
          </li>
          <li class="suggestion-item">
            <span class="suggestion-icon">✍️</span>
            <span>Work on a personal project</span>
          </li>
        </ul>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" onclick="openExtensionPopup()">
          View Statistics
        </button>
        <button class="btn btn-secondary" onclick="window.close()">
          Close Tab
        </button>
      </div>
    </div>
  </div>

  <script>
    // Chrome APIs are available globally

    // Site display names mapping
    const SITE_DISPLAY_NAMES = {
      'youtube.com': 'YouTube',
      'facebook.com': 'Facebook',
      'twitter.com': 'Twitter',
      'instagram.com': 'Instagram',
      'tiktok.com': 'TikTok',
      'reddit.com': 'Reddit'
    };

    // Get site from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const site = urlParams.get('site') || 'this website';
    
    // Update site name
    const siteNameElement = document.getElementById('site-name');
    if (siteNameElement) {
      siteNameElement.textContent = formatSiteName(site);
    }
    
    // Format site name for display
    function formatSiteName(site) {
      return SITE_DISPLAY_NAMES[site] || site.charAt(0).toUpperCase() + site.slice(1);
    }

    // Update countdown to midnight
    function updateCountdown() {
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(0, 0, 0, 0);
      
      const timeDiff = tomorrow.getTime() - now.getTime();
      
      const hours = Math.floor(timeDiff / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
      
      const countdownElement = document.getElementById('countdown');
      if (countdownElement) {
        countdownElement.textContent = 
          `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
    }

    // Load time data with better error handling
    async function loadTimeData() {
      try {
        if (!chrome?.runtime?.sendMessage) {
          console.warn('Chrome runtime not available');
          return;
        }

        const response = await chrome.runtime.sendMessage({
          action: 'getTimeData',
          site: site
        });
        
        if (response?.success && response.data) {
          const timeUsedMs = response.data.timeSpent;
          const hours = Math.floor(timeUsedMs / (60 * 60 * 1000));
          const minutes = Math.floor((timeUsedMs % (60 * 60 * 1000)) / (60 * 1000));
          
          const timeUsedElement = document.getElementById('time-used');
          if (timeUsedElement) {
            timeUsedElement.textContent = 
              `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
          }
        }
      } catch (error) {
        console.error('Error loading time data:', error);
        // Fallback: keep the default display
      }
    }

    // Open extension popup with better UX
    function openExtensionPopup() {
      try {
        if (chrome?.tabs?.create) {
                     chrome.tabs.create({ url: chrome.runtime.getURL('src/popup/popup.html') });
        } else {
          // Fallback: show helpful instructions
          alert('Click the Website Time Manager extension icon in your browser toolbar to view detailed statistics and manage settings.');
        }
      } catch (error) {
        console.error('Error opening popup:', error);
        alert('Click the Website Time Manager extension icon in your browser toolbar to view detailed statistics and manage settings.');
      }
    }

    // Initialize page
    function initializePage() {
      updateCountdown();
      loadTimeData();
      
      // Update countdown every second
      setInterval(updateCountdown, 1000);

      // Show motivational quote after 2 seconds
      setTimeout(showMotivationalQuote, 2000);
    }

    // Show motivational quote
    function showMotivationalQuote() {
      const quotes = [
        "The best time to plant a tree was 20 years ago. The second best time is now.",
        "Your future self will thank you for the choices you make today.",
        "Small steps in the right direction can turn out to be the biggest step of your life.",
        "Progress, not perfection.",
        "Time is the most valuable thing we have.",
        "Success is the sum of small efforts repeated day in and day out.",
        "The only way to do great work is to love what you do."
      ];

      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      const quoteElement = document.createElement('div');
      quoteElement.className = 'quote-container';
      quoteElement.innerHTML = `"${randomQuote}"`;
      
      const blockedContent = document.querySelector('.blocked-content');
      if (blockedContent) {
        blockedContent.appendChild(quoteElement);
      }
    }

    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.close();
      } else if (e.key === 'Enter') {
        openExtensionPopup();
      }
    });

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializePage);
    } else {
      initializePage();
    }
  </script>
</body>
</html> 